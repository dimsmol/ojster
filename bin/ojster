#!/usr/bin/env node

var optimist = require('optimist');
optimist.usage('Usage: $0 srcPath [dstPath] --goog [str] --tab [num]');

var ojster = require('../');
var argv = optimist.argv._;
var l = args.length;
if (l < 1)
{
	abort(optimist.help() + 'srcPath argument is required');
}

var srcPath = args[0];
var dstPath = null;
if (l >= 2)
{
	dstPath = args[1];
}

var generatorClass = null;
if (argv.goog)
{
	generatorClass = ojster.generators.GoogGenerator;
}

var useScope = !!argv.scope;

var options = {};
if (generatorClass != null || useScope)
{
	options.generator = options.generator || {};
	if (generatorClass != null)
	{
		options.generator.generatorClass = generatorClass;
	}
	if (useScope)
	{
		options.generator.useScope = useScope;
	}
}

if (argv.tab)
{
	tabSize = parseInt(argv.tab, 10); // WARN can return NaN
	if (tabSize > 0)
	{
		options.tabSize = tabSize;
	}
}

ojster.compile_path(srcPath, dstPath, options, function(err, results) {
	if (err)
	{
		process.exit(1);
	}

	process.exit(0);
});


function abort(str) {
	console.error(str);
	process.exit(1);
}
